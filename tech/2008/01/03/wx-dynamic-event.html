<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta content='IE=edge,chrome=1' http-equiv=X-UA-Compatible> <!--[if (lt IE 9)&(!IEMobile)]><script src="/javascripts/html5.js?1593163369"></script><![endif]--> <meta content='width=device-width, initial-scale=1.0' name=viewport> <title>wxWidgets动态事件表爱好者备查手册</title> <link href="/stylesheets/site.css?1593163369" rel=stylesheet /> <link href="/stylesheets/blog.css?1593163369" rel=stylesheet /> <link href="/stylesheets/highlight/railscasts.css?1593163369" rel=stylesheet /> <!--[if lt IE 9]><script src="/javascripts/respond.js?1593163369"></script><![endif]--> </head> <body class=''> <div id=container> <div id=main role=main> <aside class=sidebar> <nav> <span> <a href='/tech/'>home</a> </span> <span> <a href='/tech/calendar.html'>calendar</a> </span> <span> <a href='/tech/tags.html'>tags</a> </span> </nav> </aside> <div class=content> <header> <div class=article_nav> <span class=later> <a href='/tech/2008/02/18/spring-vocation.html'> < 更新 </a> </span> <span class=earlier> <a href='/tech/2007/12/19/wx-clip-summarize.html'> 更早 > </a> </span> </div> <h1> wxWidgets动态事件表爱好者备查手册 </h1> </header> <article class=markdown-body> <blockquote> <p>使用动态事件映射方法的原因，可能是你想在程序运行的不同时刻使用不同的映射关系，或者因为你使用的那种语言(例如python)不支持静态映射，或者仅仅是因为你更喜欢动态映射。因为动态映射的方法可以使你更精确的控制事件表的细节，你甚至可以单独的将事件表中的某一个条目在运行期打开或者关闭，而前面说的PushEventHandler和PopEventHandler的方法只能针对整个事件表进行处理。除此以外，动态事件处理还允许你在不同的类之间共享事件函数。<br> ——《WxWidgets跨平台GUI开发》</p> </blockquote> <h2>导言</h2> <p>在wxWidgets中，相对于静态事件表那种僵死并且不知其所以然的方法,我更喜欢动态事件表,亲自Connect，还可以随时Disconnect。<br> 但是，在写动态事件表时，会遇到一个问题，wxWidgets的官方文档中的事件处理部份，对于静态事件表所需的各种事件类型的宏叙述详尽，却对动态事件表所需的事件类型语焉不详，这给我们的使用带来了麻烦。需要的知识一方面零星分布于wx文档中，另一方面被冗长的代码掩映在<code>&lt;wx/event.h&gt;</code>中。此文的目的，就是为动态事件表的爱好者提供一个方便查询的手册，希望能给大家帮助。<br> 大部份写GUI常用的wx类（包括窗口、对话框、控件）都继承于三个类：<code>wxWindow</code>、<code>wxEvtHandler</code>、<code>wxObject</code>。因此，大多数情况下，这三个类的成员函数是我们可以顺手牵过来用的。动态事件表的使用中，最为重要的函数Connect和Disconnect就是<code>wxEvtHandler</code>的成员函数，我们可以牵过来给我们手头这个要处理事件的wx类用。</p> <p>先看看官方文档里对Connect函数的介绍（我对其进行了翻译、精简，有时，为了解释的明晰，作一些补充说明）：</p> <h3>wxEvtHandler::Connect</h3> <p>Connect函数被重载了三次，各有各的用途。</p> <p>第一个版本：范围捕杀 （ [id, lastid] 且 eventType）</p> <pre lang=cpp><code>void Connect(int id, int lastId, wxEventType eventType, wxObjectEventFunction function, wxObject* userData = NULL, wxEvtHandler* eventSink = NULL)
</code></pre> <p>第二个版本：精确狙击（id 且 eventType）</p> <pre lang=cpp><code>void Connect(int id, wxEventType eventType, wxObjectEventFunction function, wxObject* userData = NULL, wxEvtHandler* eventSink = NULL)
</code></pre> <p>第三个版本：分门别类 （仅 eventType）</p> <pre lang=cpp><code>void Connect(wxEventType eventType, wxObjectEventFunction function, wxObject* userData = NULL, wxEvtHandler* eventSink = NULL)
</code></pre> <p>该函数动态地将所给事件处理函数 与 EventHandler、ID 甚至事件类型联系起来。这是静态事件表的一种替代选择。</p> <p>参数意义：</p> <h4>id</h4> <p>你要和事件处理函数联系起来的ID（可以是窗口ID、菜单ID、控件ID）。对于没有这个参数的重载版本，id被默认设为<code>wxID_ANY</code>。</p> <p>当和lastid连用时，表达的是一个ID范围，即大小介于id和last id之间的所有ID，都会被Connect函数与事件处理函数联系起来。</p> <blockquote> <p>按：实在没必要连“ID”都译成“标识符”……其实看技术文档时，我最头痛的是一堆汉字堆在那里，包括看数学书时……</p> </blockquote> <h4>lastId</h4> <p>参见id中的介绍。</p> <h4>eventType</h4> <p>你要和事件处理函数联系起来的Event Type。 按：Event Type直译为“事件类型”并不恰当，因为事件类型是指形如<code>wxMouseEvent</code>这样的东西，而这里所指，是形如wxEVT_MOTION这样的东西。 准确地说，应该称之为“事件标识符”或“事件ID”。下文使用“事件ID”。 一个事件类型里，会有若干事件ID，比<code>wxMouseEvent</code>里除了<code>wxEVT_MOTION</code>，还有<code>wxEVT_LEFT_DOWN</code>等等等事件ID。 因此可以把事件ID作为对事件类型的一个细分。</p> <h4>function</h4> <p>事件处理函数。注意这个函数应当被显式转换为正确的类型。 对于类型为<code>wxFooEvent</code>的事件，转换使用宏<code>wxFooEventHandler</code>。</p> <h4>userData</h4> <p>你要和事件表项联系起来的数据。（暂时我还不知道这个有什么用）</p> <h4>eventSink</h4> <p>告诉Connect函数，你要调用的事件处理函数是谁的成员函数。 如果该参数为NULL, 那么Connect函数将使用this指针。</p> <blockquote> <p>按：正是这个参数允许了我们在不同类中共享事件处理函数。</p> </blockquote> <p>例子：</p> <pre lang=cpp><code>  frame-&gt;Connect( wxID_EXIT,
                  wxEVT_COMMAND_MENU_SELECTED,
                  wxCommandEventHandler(MyFrame::OnQuit) );
</code></pre> <p>对例子的解释：</p> <p><code>wxID_EXIT</code>是之前赋给了某一个菜单项的ID。</p> <p>当该菜单被选择时，会产生一个ID为<code>wxEVT_COMMAND_MENU_SELECTED</code>的事件。</p> <p>因此<code>MyFrame::OnQuit</code>在被显式转换为<code>wxCommandEventHandler</code>型的事件Handler之后，被Connect拉过来处理该事件。</p> <p>就不再翻译Disconnect函数的文档了，因为除了函数名不同，它的所有参数和Connect是一模一样的。它的用途就是断开Connect所建立起来的联系。</p> <p>实践中写事件处理的时候，通常使用的是Connect的后两种重载版本。参数userData和eventSink的使用是比较少的，而且也有默认值，一般不去理它就可以了。</p> <p>参数id是你赋给产生了这个事件的窗口、菜单或控件的，你自己心里是清楚的。问题顶多是，你需要使用系统默认的那些ID（比如上面例子里的<code>wxID_EXIT</code>），而你不知道哪个还哪个。那些ID的列表在官方文档里是有的，不过为了本文作为手册的完整性，将在本文最后给出。</p> <p>有时是不需要id的，比如鼠标移动的事件：</p> <pre lang=cpp><code>frame-&gt;Connect(wxEVT_MOTION,wxMouseEventHandler(MyFrame::OnMouseMove));
</code></pre> <p>直接把事件ID与事件Handler联系起来。</p> <p>参数function的问题大一些，就是这个显式强制类型转换的这个Handler，具体叫wx什么EventHandler呢？这个问题也好解决，因为官方文档里的Classes By Category里的Event小节已经给出了形如wxFooEvent这样的事件类型的列表，只需要在相应的事件类型后面加上Handler就可以了。同样为了本文作为手册的完整性，将在本文后面给出全部Handler的列表。</p> <p>最大的问题出在参数eventType上。形如<code>wxEVT_MOTION</code>、<code>wxEVT_COMMAND_MENU_SELECTED</code>这样的事件ID的名字，我们从何得知？这些奇形怪状的名字，纵然我们英语很强，也未必能造出和wxWidgets定义的一模一样的名字啊。比如写惯MFC的同好们很容易将鼠标移动事件ID写为<code>wxMOUSEMOVE</code>或<code>wxMOUSE_MOVE</code>，可这却是错的。最糟糕的是，文档中没有提供这些名字的列表！</p> <p>有些同好可能发现了，对大部份事件类型的静态事件表的宏的说明中，包含了这方面的重要信息，例如<code>wxPaintEvent</code>里：</p> <blockquote> <p>EVT_PAINT(func) Process a wxEVT_PAINT event.</p> </blockquote> <p>左边是静态事件表需要的，右边是动态事件表需要的。左手静态，右手动态，好潇洒啊！然而，倘若你要处理窗口关闭事件（假设该事件的产生不是通过菜单选择，而是点窗口右上角的红叉叉），你跑到<code>wxCloseEvent</code>那里一看：</p> <blockquote> <p>EVT_CLOSE(func) Process a close event, supplying the member function. This event applies to wxFrame and wxDialog classes.</p> </blockquote> <p>你晕了……为什么文档编写者连这都不肯告诉你？！于是你尝试着用<code>wxEVT_CLOSE</code>，编译器告诉你不对。已经习惯了没事翻翻头文件的你就跑到<code>&lt;wx/event.h&gt;</code>里去找了，一搜索就出来了。 原来是<code>wxEVT_CLOSE_WINDOW</code>，这可真是情理之中意料之外啊，反正我当时是接近吐血了……</p> <p>所幸这个情况并没有出现在大多数基本的事件里，但实际中总会需要处理那些不那么基本的事件的，每次都在这个细节上卡这么久的壳太不划算了。所以我把事件ID列表从<code>&lt;wx/event.h&gt;</code>中抽出来并加以翻译，大家放在手边备查吧。这是本文的主要写作目的。</p> <p>说了一堆稀哩哗啦的废话，下面进入手册正文。</p> <blockquote> <p>按： 考虑到当年写的完整列表到现在已经不完整了，将内容删除，只留下第一段和每段的标题作为demo</p> </blockquote> <h2>事件ID列表</h2> <h3>命令事件</h3> <ul> <li>wxEVT_COMMAND_BUTTON_CLICKED, 1</li> <li>wxEVT_COMMAND_CHECKBOX_CLICKED, 2</li> <li>wxEVT_COMMAND_CHOICE_SELECTED, 3</li> <li>wxEVT_COMMAND_LISTBOX_SELECTED, 4</li> <li>wxEVT_COMMAND_LISTBOX_DOUBLECLICKED, 5</li> <li>wxEVT_COMMAND_CHECKLISTBOX_TOGGLED, 6</li> </ul> <h3>鼠标事件</h3> <h3>非客户区（Non-client）鼠标事件</h3> <h3>字符输入事件</h3> <h3>设置焦点（Cursor）事件</h3> <h3>来自wxScrollBar控件和wxSlider控件的滚动事件</h3> <h3>来自wxWindow的滚动事件</h3> <h3>系统事件</h3> <h3>剪贴板事件</h3> <h3>通用命令事件（注意，一个Click事件是比button down/up优先级更高的。）</h3> <h3>帮助事件</h3> <h2>事件Handler列表</h2> <ul> <li>wxCommandEventHandler</li> <li>wxScrollEventHandler</li> <li>wxScrollWinEventHandler</li> <li>wxSizeEventHandler</li> <li>wxMoveEventHandler</li> <li>wxPaintEventHandler</li> <li>wxNcPaintEventHandler</li> <li>wxEraseEventHandler</li> <li>wxMouseEventHandler</li> <li>wxCharEventHandler</li> <li>wxKeyEventHandler</li> <li>wxCharEventHandler</li> <li>wxFocusEventHandler</li> <li>wxChildFocusEventHandler</li> <li>wxActivateEventHandler</li> <li>wxMenuEventHandler</li> <li>wxJoystickEventHandler</li> <li>wxDropFilesEventHandler</li> <li>wxInitDialogEventHandler</li> <li>wxSysColourChangedEventHandler</li> <li>wxDisplayChangedEventHandler</li> <li>wxUpdateUIEventHandler</li> <li>wxIdleEventHandler</li> <li>wxCloseEventHandler</li> <li>wxShowEventHandler</li> <li>wxIconizeEventHandler</li> <li>wxMaximizeEventHandler</li> <li>wxNavigationKeyEventHandler</li> <li>wxPaletteChangedEventHandler</li> <li>wxQueryNewPaletteEventHandler</li> <li>wxWindowCreateEventHandler</li> <li>wxWindowDestroyEventHandler</li> <li>wxSetCursorEventHandler</li> <li>wxNotifyEventHandler</li> <li>wxHelpEventHandler</li> <li>wxContextMenuEventHandler</li> <li>wxMouseCaptureChangedEventHandler</li> <li>wxMouseCaptureLostEventHandler</li> <li>wxClipboardTextEventHandler*</li> </ul> <section class=meta> <p> <span class=author> <a href='/'>宋皿</a> </span> <span class=time> <time datetime='2008-01-03 00:00:00 +0800'> 2008-01-03 </time> </span> </p> <p> <span class=license> Published under <a href='http://creativecommons.org/licenses/by-nc-nd/3.0/' rel=license>(CC) BY-NC-ND</a> </span> <span class=tags> tagged with <a href='/tech/tags.html#tag-cpp'> cpp </a> <a href='/tech/tags.html#tag-wx'> wx </a> </span> </p> </section> <div id=disqus_thread></div> <script>
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'utensil-at-github'; // required: replace example with your forum shortname
  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script> <a class=dsq-brlink href='http://disqus.com'> comments powered by <span class=logo-disqus>Disqus</span> </a> </article> </div> </div> </div> <script src="/javascripts/jquery-1.7.1.js?1593163369"></script> <script src="/javascripts/highlight.pack.js?1593163369"></script> <script>
  hljs.initHighlightingOnLoad();
  // $(document).ready(function() {
  //   $('pre code').each(function(i, e) {hljs.highlightBlock(e)});
  // });
</script> <script>
  // (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!== typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]); b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]); mixpanel.init("eda89891866a7e90b6699df21e79ea61");
  // mixpanel.track("visit");
</script> </body> </html>